---
title: "R Notebook"
output: html_notebook
---
```{r}
#install.packages('ecb')

#### Data from ECB ####
rm(list=ls())
library(ecb)
```

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
names<-list("ICP.M.FR.N.000000.4.INX", "ICP.M.FR.N.010000.4.INX", "ICP.M.FR.N.020000.4.INX", "ICP.M.FR.N.030000.4.INX", "ICP.M.FR.N.040000.4.INX",	"ICP.M.FR.N.050000.4.INX", "ICP.M.FR.N.060000.4.INX", "ICP.M.FR.N.070000.4.INX",	"ICP.M.FR.N.080000.4.INX",	"ICP.M.FR.N.090000.4.INX",	"ICP.M.FR.N.100000.4.INX",	"ICP.M.FR.N.110000.4.INX",	"ICP.M.FR.N.120000.4.INX")

x<-get_data("ICP.M.FR.N.000000.4.INX",filter=list(startPeriod=2000,endPeriod=2022))
data=data.frame(as.Date(paste(x$obstime,1,sep="-"),"%Y-%m-%d"))

for (i in names){
  x<-get_data(i,filter=list(startPeriod=2000,endPeriod=2022))
  data<-cbind(data,x$obsvalue)
}

names(data)<-c('Date','HICP - Overall index',	'HICP - FOOD','HICP - ALCOHOL, TOBACCO','HICP - CLOTHING','HICP - ELECTRICITY, GAS','HICP - FURNISHINGS','HICP - HEALTH','HICP - TRANSPORT','HICP - COMMUNICATION','HICP - RECREATION	','HICP - EDUCATION	','HICP - RESTAURANTS','HICP - MISCELLANEOUS')

colnames(data) <- gsub('HICP - ', '', colnames(data), fixed=TRUE)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.
```{r}
library(ggplot2)
library(reshape2)
library(dplyr)

d <- melt(data, id.vars="Date")
d<-d %>%
    group_by(variable) %>%
    mutate(VAL.IND = value/value[Date=="2000-01-01"])

ggplot(d, aes(x=Date,y=VAL.IND, col=variable)) + 
  geom_path()
```


```{r}
library(readxl)
average_con <- read_excel("average_con.xlsx", 
    sheet = "Sheet 1")

colnames(average_con)<-c("Date","Type","Value")
average_con[,1]<-as.Date(average_con$Date, "%Y")
average_con[,3]<-as.numeric(average_con$Value)

cons_per_decile <- read_excel("cons_per_decile.xlsx", 
    sheet = "Feuil1")
```


```{r}
average_con<-average_con %>% filter(Type!="Total")
average_con<-average_con %>% filter(Date!="2021-08-25")

ggplot(average_con, aes(fill=Type, y=Value, x=Date)) + 
  geom_bar(position="stack", stat="identity")
```

```{r}
colnames(cons_per_decile)<-c("Type","income_grp","s_1999","s_2005","s_2010","s_2015")
d<-cons_per_decile %>%
    group_by(income_grp) %>%
    mutate(Somme_1999 = sum(s_1999), Somme_2005=sum(s_2005), Somme_2010=sum(s_2010), Somme_2015=sum(s_2015))

share<-d %>%
  group_by(income_grp) %>%
  summarize(Type=Type, s_1999/Somme_1999, s_2005/Somme_2005, s_2010/Somme_2010, s_2015/Somme_2015 )

colnames(share)<-c("income_grp","Type","s_1999","s_2005","s_2010","s_2015")
```


```{r}
library(tidyr)
first<-data_long %>%
  filter(Date=="s_1999")
second<-data_long %>%
  filter(Date=="s_2005")
third<-data_long %>%
  filter(Date=="s_2010")
fourth<-data_long %>%
  filter(Date=="s_2015")

data_long <- gather(share, Date, value, s_1999:s_2015, factor_key=TRUE)

ggplot(first, aes(fill=Type, y=value, x=income_grp)) + 
  geom_bar(position="stack", stat="identity")

ggplot(second, aes(fill=Type, y=value, x=income_grp)) + 
  geom_bar(position="stack", stat="identity")
ggplot(third, aes(fill=Type, y=value, x=income_grp)) + 
  geom_bar(position="stack", stat="identity")
ggplot(fourth, aes(fill=Type, y=value, x=income_grp)) + 
  geom_bar(position="stack", stat="identity")

```


